---
title: åŸå‹é“¾æ·±åº¦è§£æ
description: ""
publishDate:  2025-10-04
tags: []
draft: false
---


## å›¾è¡¨è§£è¯»

```mermaid
graph TD
    A[Function] -->|__proto__| B[Function.prototype]
    B -->|__proto__| C[Object.prototype]
    C -->|__proto__| D[null]
    
    E[Object] -->|__proto__| B
    F[Array] -->|__proto__| B
    G[æ‰€æœ‰å…¶ä»–å‡½æ•°] -->|__proto__| B
```

è¿™ä¸ªå›¾è¡¨æ­ç¤ºäº† JavaScript ä¸­æœ€æ ¸å¿ƒçš„åŸå‹é“¾å…³ç³»ï¼š**æ‰€æœ‰å‡½æ•°éƒ½æ˜¯ Function çš„å®ä¾‹ï¼Œè€Œ Function æœ¬èº«ä¹Ÿéµå¾ªåŸå‹é“¾è§„åˆ™ã€‚**

## æ ¸å¿ƒæ¦‚å¿µ

### 1. åŸå‹é“¾çš„æœ¬è´¨

åŸå‹é“¾æ˜¯ JavaScript å®ç°ç»§æ‰¿çš„æœºåˆ¶ã€‚æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå†…éƒ¨å±æ€§ `[[Prototype]]`ï¼ˆé€šè¿‡ `__proto__` è®¿é—®ï¼‰ï¼ŒæŒ‡å‘å®ƒçš„åŸå‹å¯¹è±¡ã€‚

```javascript
// åŸºç¡€ç¤ºä¾‹
const obj = {};
console.log(obj.__proto__ === Object.prototype); // true
console.log(Object.prototype.__proto__ === null); // true
```

### 2. å‡½æ•°çš„åŒé‡èº«ä»½

**å…³é”®ç†è§£ï¼šå‡½æ•°æ—¢æ˜¯å¯¹è±¡ï¼Œä¹Ÿæ˜¯æ„é€ å‡½æ•°ã€‚**

```javascript
// Function æ„é€ å‡½æ•°æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°
console.log(typeof Function); // 'function'
console.log(Function instanceof Function); // true
console.log(Function instanceof Object); // true

// éªŒè¯ Function çš„åŸå‹é“¾
console.log(Function.__proto__ === Function.prototype); // true
console.log(Function.prototype.__proto__ === Object.prototype); // true
```

## é€æ­¥åˆ†æå›¾è¡¨

### ç¬¬ä¸€å±‚ï¼šFunction çš„è‡ªæŒ‡å‘ - æœ€ç‰¹æ®Šçš„å…³ç³»

```javascript
// Function æ„é€ å‡½æ•°æŒ‡å‘ Function.prototype
console.log(Function.__proto__ === Function.prototype); // true

// è¿™æ˜¯ JavaScript ä¸­å”¯ä¸€çš„è‡ªæŒ‡å‘å…³ç³»
// Function æ˜¯å”¯ä¸€ä¸€ä¸ª __proto__ æŒ‡å‘è‡ªå·± prototype çš„å¯¹è±¡
```



#### ğŸ¯ è‡ªæŒ‡å…³ç³»çš„æ„ä¹‰

```javascript
// è¿™ç§è‡ªæŒ‡å…³ç³»ç¡®ä¿äº†ï¼š
// 1. Function èƒ½å¤Ÿè®¿é—®æ‰€æœ‰å‡½æ•°çš„é€šç”¨æ–¹æ³•
console.log(Function.call); // æ¥è‡ª Function.prototype.call
console.log(Function.apply); // æ¥è‡ª Function.prototype.apply

// 2. Function éµå¾ªç»Ÿä¸€çš„åŸå‹é“¾è§„åˆ™
console.log(Function.__proto__); // Function.prototype
console.log(Function.__proto__.__proto__); // Object.prototype
console.log(Function.__proto__.__proto__.__proto__); // null

// 3. instanceof æ“ä½œç¬¦æ­£ç¡®å·¥ä½œ
console.log(Function instanceof Function); // true
console.log(Function instanceof Object); // true
```

### ç¬¬äºŒå±‚ï¼šFunction.prototype ä½œä¸ºæ‰€æœ‰å‡½æ•°çš„ " åŸºç±» "

```javascript
// Function.prototype æŒ‡å‘ Object.prototype
console.log(Function.prototype.__proto__ === Object.prototype); // true

// Function.prototype æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç©ºå‡½æ•°
console.log(Function.prototype); // Æ’ () { [native code] }
console.log(typeof Function.prototype); // 'function'
```

#### ğŸ—ï¸ Function.prototype åŒ…å«çš„æ ¸å¿ƒå±æ€§å’Œæ–¹æ³•

```javascript
// æŸ¥çœ‹ Function.prototype çš„æ‰€æœ‰å±æ€§
const methods = Object.getOwnPropertyNames(Function.prototype);
console.log(methods); 
// ['length', 'name', 'arguments', 'caller', 'constructor', 'apply', 'bind', 'call', 'toString']

// æ ¸å¿ƒæ–¹æ³•ï¼š
console.log(Function.prototype.call);      // Æ’ call() { [native code] }
console.log(Function.prototype.apply);     // Æ’ apply() { [native code] }
console.log(Function.prototype.bind);      // Æ’ bind() { [native code] }
console.log(Function.prototype.toString);  // Æ’ toString() { [native code] }
```


**å…³é”®ç†è§£ï¼š** Function.prototype å°±åƒæ˜¯æ‰€æœ‰å‡½æ•°çš„ " æ¨¡æ¿ "ï¼Œå®šä¹‰äº†å‡½æ•°çš„åŸºæœ¬èƒ½åŠ›ï¼ˆcallã€applyã€bind ç­‰ï¼‰ï¼Œæ‰€æœ‰å‡½æ•°éƒ½ä»è¿™é‡Œç»§æ‰¿äº†è¿™äº›æ ¸å¿ƒæ–¹æ³•ã€‚

### ç¬¬ä¸‰å±‚ï¼šObject.prototype æŒ‡å‘ null

```javascript
// åŸå‹é“¾çš„ç»ˆç‚¹
console.log(Object.prototype.__proto__ === null); // true
```

è¿™æ˜¯åŸå‹é“¾çš„é¡¶ç«¯ï¼Œ`null` è¡¨ç¤ºåŸå‹é“¾çš„ç»“æŸã€‚

### å…¶ä»–å‡½æ•°çš„åŸå‹é“¾

```javascript
// Object æ„é€ å‡½æ•°
console.log(Object.__proto__ === Function.prototype); // true
console.log(typeof Object); // 'function'

// Array æ„é€ å‡½æ•°
console.log(Array.__proto__ === Function.prototype); // true
console.log(typeof Array); // 'function'

// è‡ªå®šä¹‰å‡½æ•°
function myFunction() {}
console.log(myFunction.__proto__ === Function.prototype); // true

// ç®­å¤´å‡½æ•°ä¹Ÿä¸€æ ·
const arrowFunc = () => {};
console.log(arrowFunc.__proto__ === Function.prototype); // true
```


## æ·±åº¦ç†è§£ï¼šconstructor å±æ€§

æ¯ä¸ª `prototype` å¯¹è±¡éƒ½æœ‰ä¸€ä¸ª `constructor` å±æ€§ï¼ŒæŒ‡å›æ„é€ å‡½æ•°ï¼š

```javascript
// constructor å±æ€§çš„å¾ªç¯å¼•ç”¨
console.log(Function.prototype.constructor === Function); // true
console.log(Object.prototype.constructor === Object); // true
console.log(Array.prototype.constructor === Array); // true

// è¿™å½¢æˆäº†ä¸€ä¸ªå¾ªç¯å¼•ç”¨ç³»ç»Ÿ
// Function â†” Function.prototype
// Object â†” Object.prototype
// Array â†” Array.prototype
```

## å®é™…åº”ç”¨åœºæ™¯

### 1. ç†è§£ instanceof è¿ç®—ç¬¦

```javascript
// instanceof æ²¿ç€åŸå‹é“¾æŸ¥æ‰¾
console.log(Function instanceof Object); // true
// å› ä¸º Function.__proto__.__proto__ === Object.prototype

console.log(Object instanceof Function); // true  
// å› ä¸º Object.__proto__ === Function.prototype

console.log(Array instanceof Function); // true
console.log(Array instanceof Object); // true

// è‡ªå®šä¹‰å‡½æ•°
function MyFunc() {}
console.log(MyFunc instanceof Function); // true
console.log(MyFunc instanceof Object); // true
```

### 2. æ–¹æ³•ç»§æ‰¿çš„åŸç†

```javascript
// æ‰€æœ‰å‡½æ•°éƒ½èƒ½è°ƒç”¨ call, apply, bind
// å› ä¸ºè¿™äº›æ–¹æ³•å®šä¹‰åœ¨ Function.prototype ä¸Š

function myFunc() {
  console.log('Hello');
}

// è¿™äº›æ–¹æ³•æ¥è‡ª Function.prototype
console.log(myFunc.call === Function.prototype.call); // true
console.log(myFunc.apply === Function.prototype.apply); // true
console.log(myFunc.bind === Function.prototype.bind); // true

// éªŒè¯ç»§æ‰¿è·¯å¾„
console.log(myFunc.__proto__ === Function.prototype); // true
```

### 3. åŸå‹æ±¡æŸ“æ”»å‡»çš„åŸç†

```javascript
// å±é™©ç¤ºä¾‹ï¼šä¸è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨
// é€šè¿‡åŸå‹é“¾å¯ä»¥å½±å“æ‰€æœ‰å¯¹è±¡

// æ±¡æŸ“ Object.prototype
Object.prototype.isHacked = true;

// å½±å“æ‰€æœ‰å¯¹è±¡
const obj = {};
const arr = [];
const func = function() {};

console.log(obj.isHacked); // true
console.log(arr.isHacked); // true  
console.log(func.isHacked); // true

// æ¸…ç†
delete Object.prototype.isHacked;
```

## ç‰¹æ®Šæƒ…å†µå’Œè¾¹ç¼˜æ¡ˆä¾‹

### 1. Function.prototype çš„ç‰¹æ®Šæ€§

```javascript
// Function.prototype æ˜¯å”¯ä¸€æ—¢æ˜¯å‡½æ•°åˆæ˜¯åŸå‹çš„å¯¹è±¡
console.log(typeof Function.prototype); // 'function'
console.log(Function.prototype.length); // 0
console.log(Function.prototype.name); // ''

// ä½†å®ƒä¸èƒ½ä½œä¸ºæ„é€ å‡½æ•°ä½¿ç”¨
try {
  new Function.prototype();
} catch (e) {
  console.log('Error:', e.message); // TypeError
}
```

### 2. ç®­å¤´å‡½æ•°çš„é™åˆ¶

```javascript
// ç®­å¤´å‡½æ•°æ²¡æœ‰ prototype å±æ€§
const arrow = () => {};
console.log(arrow.prototype); // undefined

// ä½†ä»ç„¶ç»§æ‰¿è‡ª Function.prototype
console.log(arrow.__proto__ === Function.prototype); // true

// ä¸èƒ½ä½œä¸ºæ„é€ å‡½æ•°
try {
  new arrow();
} catch (e) {
  console.log('Arrow function cannot be constructor'); 
}
```

## åŸå‹é“¾éå†ç®—æ³•

```javascript
// æ‰‹åŠ¨å®ç°åŸå‹é“¾éå†
function tracePrototypeChain(obj, name = 'object') {
  console.log(`\n=== ${name} çš„åŸå‹é“¾ ===`);
  
  let current = obj;
  let level = 0;
  
  while (current !== null) {
    console.log(`Level ${level}:`, current.constructor?.name || 'null', current);
    current = Object.getPrototypeOf(current);
    level++;
    
    // é˜²æ­¢æ— é™å¾ªç¯
    if (level > 10) break;
  }
}

// æµ‹è¯•ä¸åŒå¯¹è±¡çš„åŸå‹é“¾
tracePrototypeChain(Function, 'Function');
tracePrototypeChain(Object, 'Object');
tracePrototypeChain(Array, 'Array');
tracePrototypeChain(function(){}, 'custom function');
tracePrototypeChain([], 'Array instance');
tracePrototypeChain({}, 'Object instance');
```

## å†…å­˜æ¨¡å‹å›¾è§£

```mermaid
graph TD
    %% Function æ„é€ å‡½æ•°åŠå…¶åŸå‹é“¾
    F["Function<br/>(constructor)"] 
    FP["Function.prototype<br/>(function object)"]
    OP["Object.prototype<br/>(object)"]
    N["null"]
    
    %% å…¶ä»–æ„é€ å‡½æ•°
    O["Object<br/>(constructor)"]
    A["Array<br/>(constructor)"]
    
    %% ä¸»è¦çš„ __proto__ å…³ç³»
    F -->|"__proto__"| FP
    FP -->|"__proto__"| OP
    OP -->|"__proto__"| N
    
    %% å…¶ä»–æ„é€ å‡½æ•°çš„ __proto__ å…³ç³»
    O -->|"__proto__"| FP
    A -->|"__proto__"| FP
    
    %% prototype å±æ€§å…³ç³»ï¼ˆè™šçº¿è¡¨ç¤ºï¼‰
    F -.->|"prototype"| FP
    
    %% æ ·å¼
    classDef constructor fill:#e1f5fe,stroke:#0277bd,stroke-width:2px
    classDef prototype fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef null fill:#ffebee,stroke:#c62828,stroke-width:2px
    
    class F,O,A constructor
    class FP,OP prototype
    class N null
```

**å›¾è¡¨è¯´æ˜ï¼š**

- **è“è‰²æ¡†**ï¼šæ„é€ å‡½æ•°ï¼ˆFunctionã€Objectã€Array ç­‰ï¼‰
- **ç´«è‰²æ¡†**ï¼šåŸå‹å¯¹è±¡ï¼ˆFunction.prototypeã€Object.prototypeï¼‰
- **çº¢è‰²æ¡†**ï¼šåŸå‹é“¾ç»ˆç‚¹ï¼ˆnullï¼‰
- **å®çº¿ç®­å¤´**ï¼š`__proto__` å…³ç³»ï¼ˆåŸå‹é“¾ï¼‰
- **è™šçº¿ç®­å¤´**ï¼š`prototype` å±æ€§å…³ç³»

## æœ€ä½³å®è·µä¸æ³¨æ„äº‹é¡¹

### 1. æ£€æŸ¥åŸå‹é“¾

```javascript
// å®‰å…¨çš„åŸå‹æ£€æŸ¥
function hasInPrototypeChain(obj, Constructor) {
  return obj instanceof Constructor;
}

// æ›´ç²¾ç¡®çš„æ£€æŸ¥
function isDirectInstanceOf(obj, Constructor) {
  return Object.getPrototypeOf(obj) === Constructor.prototype;
}

// æ£€æŸ¥æ˜¯å¦æ˜¯æŸä¸ªåŸå‹çš„ç›´æ¥å®ä¾‹
console.log(isDirectInstanceOf({}, Object)); // true
console.log(isDirectInstanceOf([], Object)); // false
console.log(isDirectInstanceOf([], Array)); // true
```

### 2. é¿å…ç›´æ¥ä¿®æ”¹ `__proto__`

```javascript
// âŒ ä¸æ¨èï¼šç›´æ¥ä¿®æ”¹ __proto__
const obj = {};
obj.__proto__ = Array.prototype; // æ€§èƒ½å·®ï¼Œå…¼å®¹æ€§é—®é¢˜

// âœ… æ¨èï¼šä½¿ç”¨ Object.create
const betterObj = Object.create(Array.prototype);

// âœ… æˆ–ä½¿ç”¨ Object.setPrototypeOfï¼ˆä½†ä»æœ‰æ€§èƒ½è€ƒè™‘ï¼‰
Object.setPrototypeOf(obj, Array.prototype);
```

### 3. æ€§èƒ½è€ƒè™‘

```javascript
// åŸå‹é“¾æŸ¥æ‰¾æœ‰æ€§èƒ½æˆæœ¬
const deepObj = {};
let current = deepObj;

// åˆ›å»ºå¾ˆé•¿çš„åŸå‹é“¾
for (let i = 0; i < 1000; i++) {
  const next = {};
  Object.setPrototypeOf(current, next);
  current = next;
}

// è®¿é—®ä¸å­˜åœ¨çš„å±æ€§ä¼šéå†æ•´ä¸ªåŸå‹é“¾
console.time('prototype lookup');
for (let i = 0; i < 100000; i++) {
  deepObj.nonExistentProperty; // ä¼šæŸ¥æ‰¾æ•´ä¸ªåŸå‹é“¾
}
console.timeEnd('prototype lookup');
```

